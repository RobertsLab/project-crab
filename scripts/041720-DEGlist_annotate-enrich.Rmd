---
title: 'annotate and enrich 2019 crab: infected vs uninfected'
output: github_document
---
Rmd for annotating a list of 773 DEGs from Steven (crab data 2019 - comparing infected and uninfected only). 

Files needed: 
1. 772 DEG list (2019-infection_DEGlist.tab) in project-crab/analyses
2. BLAST output from the crab transcriptome 
3. uniprot GO list (downloaded from uniprot.org - entire list with added columns of GO terms and IDs)

```{r}
#install.packages("tidyverse")
library(tidyverse)
```

# Annotation
## Upload files
DEGlist was made by SR - compares infected and uninfected from the 2019 dataset
Upload DEG list:
(I pasted list into excel in order to name the first column "Trinity_ID")
```{r}
degs <- read.table("../analyses/2019-DEGlist-infection-colnames.txt", header = TRUE)
head(degs)
```
Upload BLAST output from crab transcriptome: 
(I pasted into excel to get the data into the correct columns...)
```{r}
blastout <- read.delim("../analyses/crab-blastout.txt", header = FALSE)
head(blastout)
```
Rename column "V3" --> "Entry" so that it matches the column name rom the uniprot ID list; also rename column "V1" --> "Trinity_ID"
```{r}
colnames(blastout) <- c("Trinity_ID", "V2", "Entry", "V4", "V5", "V6", "V7", "V8", "V9", "V10", "V11", "V12", "V13", "V14")
head(blastout)
```

Upload uniprot GO list:
(File too big to be on Github --> downloaded and stored locally in my github repo for project-crab)
But I downloaded the entire uniprot ID list with all GO IDs
```{r}
go <- read.delim("../data/uniprot-reviewed.tab", sep = '\t', header = TRUE)
head(go)
```

## Annotate blastout file with GO terms (downloaded from uniprot.org)
Join based on uniprot ID (Column "Entry")

```{r}
annot_blast <- left_join(blastout, go, by = "Entry")
head(annot_blast)
```
Resulted in a file that is the same length as 'blastout' (23065 rows) with 24 columns. Seems to have worked well! 

## Annotate DEG list
Now that the blast output is annotated and the column with the Trinity IDs matches the same name as that in the DEGlist, the files are ready to be `join`-ed!
```{r}
degs_annot <- left_join(degs, annot_blast, by = "Trinity_ID")
head(degs_annot)
```
Resulting file is 783 rows (deg list is 772) and 30 columns. 

Annotation = complete. 

# Enrichment
EIMD 2019 class used GO-MWU for enrichment
"rank-based gene ontology analysis" 
MWU --> Mann-Whitney U test
"tests whether the genes belonging to a certain GO category are significantly bunched up near the top or the bottom of the global ranked list of genes, instead of being spread evenly over it."
"major advantage of this approach is that the experimenter does not have to impose an arbitrary threshold for initial selection of "significant genes", and thus the whole dataset can be used to gain information"

https://github.com/z0on/GO_MWU 

Enrichment will be done is a separate folder in analyses, called "GO-MWU". 

GO-MWU needs 2 files from the crab dataset:
1. GO annotations table of sequences (2 columns; gene ID + GO terms)
  needs to be tab-delimited, one line per gene, multiple GO terms separated by semicolon
2. table of measure of interest of sequences (2 columns; gene ID + measure of significance like log(fold-change) or -log(p-value))
  needs to be .csv

Create the first file by selecting columns "Trinity_ID" and "Gene.ontology.IDs" from the file called "degs_annot"
```{r}
crab_gene_go <- subset(degs_annot, select = c(Trinity_ID, Gene.ontology.IDs))
head(crab_gene_go)
```
Write out the file to analyses/GO-MWU, making sure it's tab-delimited (remove row names)
```{r}
write.table(crab_gene_go, "../analyses/GO-MWU/2019-crab-GO-annot.tab", sep = "\t", row.names = FALSE, quote = FALSE, col.names = FALSE)
```
Confirm file format:
```{r}
crab_annot <- read.delim("../analyses/GO-MWU/2019-crab-GO-annot.tab", sep = '\t', header = FALSE)
head(crab_annot)
```


Now create the second file, the list of genes along with some continuoous measure of significance. I'll use the "Trinity_ID" column along with "Log2FoldChange". 
```{r}
crab_gene_log2FC <- subset(degs_annot, select = c(Trinity_ID, log2FoldChange))
head(crab_gene_log2FC)
```

Input file isn't working in GO-MWU. Error message:
 Error in read.table(inname, sep = "\t", header = T, check.names = F) : 
  no lines available in input 

Maybe I need to change column 1 header to "gene"... try that now:
```{r}
colnames(crab_gene_log2FC) <- c("gene", "log2FC")
head(crab_gene_log2FC)
```

Save as .csv in analyses/GO-MWU
```{r}
write.csv(crab_gene_log2FC, "../analyses/GO-MWU/2019-crab-GO-log2fc.csv", row.names = FALSE, quote = FALSE)
```










